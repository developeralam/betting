(self.webpackChunk=self.webpackChunk||[]).push([[430],{71706:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>q});var n=a(87757),r=a.n(n),o=a(9669),s=a.n(o),i=a(50175),c=a.n(i),d=a(18623),m=a(68843);function l(e,t,a,n,r,o,s){try{var i=e[o](s),c=i.value}catch(e){return void a(e)}i.done?t(c):Promise.resolve(c).then(n,r)}function u(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var o=e.apply(t,a);function s(e){l(o,n,r,s,i,"next",e)}function i(e){l(o,n,r,s,i,"throw",e)}s(void 0)}))}}const v={mixins:[d.Z],middleware:["auth","verified","2fa_passed","admin"],metaInfo:function(){return{title:this.$t("Maintenance")}},data:function(){return{data:{},maintenanceFormIsValid:null,maintenanceForm:new(c())({message:this.$t("Sorry, we are doing some maintenance. Please check back soon.")}),commandFormIsValid:null,commandForm:new(c())({command:null,arguments:{}}),migrationForm:new(c()),cacheForm:new(c()),cronForm:new(c()),clearQueueForm:new(c())({queue:null}),stopQueueWorkerForm:new(c())}},computed:{commands:function(){return this.data.commands?this.data.commands.map((function(e){return{value:e.class,text:e.description}})):[]},dataLoaded:function(){return this.data&&Object.keys(this.data).length>0}},created:function(){var e=this;return u(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s().get("/api/admin/maintenance");case 2:a=t.sent,n=a.data,e.data=n;case 5:case"end":return t.stop()}}),t)})))()},methods:{switchMaintenanceMode:function(){var e=this;return u(r().mark((function t(){var a,n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.data.maintenance_mode?"up":"down",t.next=3,e.maintenanceForm.post("/api/admin/maintenance/".concat(a));case 3:n=t.sent,o=n.data,e.data.maintenance_mode=!e.data.maintenance_mode,e.$store.dispatch("message/success",{text:o.message});case 7:case"end":return t.stop()}}),t)})))()},executeCommand:function(){var e=this;return u(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.commandForm.post("/api/admin/maintenance/command");case 2:a=t.sent,n=a.data,e.$store.dispatch("message/success",{text:n.message});case 5:case"end":return t.stop()}}),t)})))()},migrate:function(){var e=this;return u(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.migrationForm.post("/api/admin/maintenance/migrate");case 2:a=t.sent,n=a.data,e.$store.dispatch("message/success",{text:n.message});case 5:case"end":return t.stop()}}),t)})))()},clearCache:function(){var e=this;return u(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.cacheForm.post("/api/admin/maintenance/cache");case 2:a=t.sent,n=a.data,e.$store.dispatch("message/success",{text:n.message});case 5:case"end":return t.stop()}}),t)})))()},cron:function(){var e=this;return u(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.cronForm.post("/api/admin/maintenance/cron");case 2:a=t.sent,n=a.data,e.$store.dispatch("message/success",{text:n.message});case 5:case"end":return t.stop()}}),t)})))()},clearQueue:function(){var e=this;return u(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.clearQueueForm.post("/api/admin/maintenance/queues/clear");case 2:a=t.sent,n=a.data,e.$store.dispatch("message/success",{text:n.message});case 5:case"end":return t.stop()}}),t)})))()},stopQueueWorker:function(){var e=this;return u(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.stopQueueWorkerForm.post("/api/admin/maintenance/queues/stop");case 2:a=t.sent,n=a.data,e.$store.dispatch("message/success",{text:n.message});case 5:case"end":return t.stop()}}),t)})))()},copyToClipboard:function(e){return(0,m.vQ)(e.$el.querySelector("input"))}}};var p=a(51900),_=a(43453),f=a.n(_),b=a(4330),h=a(43776),g=a(5255),w=a(17024),y=a(66530),x=a(83240),F=a(6571),$=a(57894),k=a(9047),C=a(55515),V=a(54933),Q=(0,p.Z)(v,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("v-card",[a("v-card-title",[e._v("\n          "+e._s(e.$t("Maintenance"))+"\n        ")]),e._v(" "),a("v-card-text",[a("v-row",[a("v-col",[a("v-card",{attrs:{outlined:""}},[a("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("System info"))+"\n                ")]),e._v(" "),a("v-card-text",[a("v-skeleton-loader",{attrs:{type:"list-item-three-line",loading:!e.dataLoaded}},[a("div",e._l(e.data.system_info,(function(t,n){return a("div",{key:n},[e._v("\n                        "+e._s(t.title)+": "+e._s(t.value)+"\n                      ")])})),0)])],1)],1)],1)],1),e._v(" "),a("v-row",[a("v-col",[a("v-card",{attrs:{outlined:""}},[a("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Application version"))+"\n                ")]),e._v(" "),a("v-card-text",[a("v-skeleton-loader",{attrs:{type:"text",loading:!e.dataLoaded}},[e.data.update_available?a("p",{staticClass:"warning--text mb-0"},[a("v-icon",{attrs:{color:"warning",left:""}},[e._v("\n                        mdi-alert\n                      ")]),e._v("\n                      "+e._s(e.$t("New version {0} is available ({1} currently installed).",[e.data.latest_version,e.data.current_version]))+"\n                      "),a("a",{attrs:{href:"/admin/help/app#q10"}},[e._v(e._s(e.$t("How to upgrade?")))])],1):a("p",{staticClass:"success--text mb-0"},[a("v-icon",{attrs:{color:"success",left:""}},[e._v("\n                        mdi-check-all\n                      ")]),e._v("\n                      "+e._s(e.$t("Application is up-to-date (version {0} is installed).",[e.data.latest_version]))+"\n                    ")],1)])],1)],1)],1)],1),e._v(" "),a("v-row",[a("v-col",[a("v-card",{attrs:{outlined:""}},[a("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Maintenance mode"))+"\n                ")]),e._v(" "),a("v-card-text",[a("p",[e._v("\n                    "+e._s(e.$t("You can enable maintenance mode during application upgrade or when doing other service tasks, so nobody except administrators can use the website."))+"\n                  ")]),e._v(" "),a("v-form",{staticClass:"mt-5",on:{submit:function(t){return t.preventDefault(),e.switchMaintenanceMode(t)}},model:{value:e.maintenanceFormIsValid,callback:function(t){e.maintenanceFormIsValid=t},expression:"maintenanceFormIsValid"}},[a("v-text-field",{attrs:{label:e.$t("Message"),rules:[e.validationRequired],error:e.maintenanceForm.errors.has("message"),"error-messages":e.maintenanceForm.errors.get("message"),disabled:void 0===e.data.maintenance_mode||e.data.maintenance_mode,outlined:""},model:{value:e.maintenanceForm.message,callback:function(t){e.$set(e.maintenanceForm,"message",t)},expression:"maintenanceForm.message"}}),e._v(" "),a("v-skeleton-loader",{attrs:{type:"button",loading:!e.dataLoaded}},[a("v-btn",{attrs:{type:"submit",color:"primary",disabled:!e.maintenanceFormIsValid||e.maintenanceForm.busy,loading:e.maintenanceForm.busy}},[e.data.maintenance_mode?[e._v("\n                          "+e._s(e.$t("Disable maintenance mode"))+"\n                        ")]:[e._v("\n                          "+e._s(e.$t("Enable maintenance mode"))+"\n                        ")]],2)],1)],1)],1)],1)],1)],1),e._v(" "),a("v-row",[a("v-col",[a("v-card",{attrs:{outlined:""}},[a("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Tasks"))+"\n                ")]),e._v(" "),a("v-card-text",[a("p",[e._v("\n                    "+e._s(e.$t("The app provides a number of service tasks, which can be executed on demand."))+"\n                  ")]),e._v(" "),a("v-form",{staticClass:"mt-5",on:{submit:function(t){return t.preventDefault(),e.executeCommand(t)}},model:{value:e.commandFormIsValid,callback:function(t){e.commandFormIsValid=t},expression:"commandFormIsValid"}},[a("v-select",{attrs:{items:e.commands,label:e.$t("Task"),error:e.commandForm.errors.has("command"),"error-messages":e.commandForm.errors.get("command"),outlined:"",disabled:!e.data.commands},model:{value:e.commandForm.command,callback:function(t){e.$set(e.commandForm,"command",t)},expression:"commandForm.command"}}),e._v(" "),e.commandForm.command?[e._l(e.data.commands,(function(t){return[t.class===e.commandForm.command?e._l(t.arguments,(function(t,n){return a("v-text-field",{key:n,attrs:{label:e.$t(t.title),rules:[e.validationRequired],placeholder:t.default,error:e.commandForm.errors.has("arguments"),"error-messages":e.commandForm.errors.get("arguments"),outlined:""},model:{value:e.commandForm.arguments[t.id],callback:function(a){e.$set(e.commandForm.arguments,t.id,a)},expression:"commandForm.arguments[arg.id]"}})})):e._e()]}))]:e._e(),e._v(" "),a("v-skeleton-loader",{attrs:{type:"button",loading:!e.dataLoaded}},[a("v-btn",{attrs:{type:"submit",color:"primary",disabled:!e.commandForm.command||!e.commandFormIsValid||e.commandForm.busy,loading:e.commandForm.busy}},[e._v("\n                        "+e._s(e.$t("Execute"))+"\n                      ")])],1)],2)],1)],1)],1)],1),e._v(" "),a("v-row",[a("v-col",[a("v-card",{attrs:{outlined:""}},[a("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Database"))+"\n                ")]),e._v(" "),a("v-card-text",[a("p",[e._v("\n                    "+e._s(e.$t("After upgrading to a new version of the application it is necessary to update the database objects."))+"\n                    "+e._s(e.$t("All current data will be preserved."))+"\n                  ")]),e._v(" "),a("v-form",{on:{submit:function(t){return t.preventDefault(),e.migrate(t)}}},[a("v-skeleton-loader",{attrs:{type:"button",loading:!e.dataLoaded}},[a("v-btn",{attrs:{type:"submit",color:"primary",disabled:e.migrationForm.busy,loading:e.migrationForm.busy}},[e._v("\n                        "+e._s(e.$t("Update database"))+"\n                      ")])],1)],1)],1)],1)],1)],1),e._v(" "),a("v-row",[a("v-col",[a("v-card",{attrs:{outlined:""}},[a("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Cache"))+"\n                ")]),e._v(" "),a("v-card-text",[a("p",[e._v("\n                    "+e._s(e.$t("The application caches templates, configuration, translation strings, aggregated data etc to improve performance."))+"\n                    "+e._s(e.$t("To clear all caches at once click the button below."))+"\n                  ")]),e._v(" "),a("v-form",{on:{submit:function(t){return t.preventDefault(),e.clearCache(t)}}},[a("v-skeleton-loader",{attrs:{type:"button",loading:!e.dataLoaded}},[a("v-btn",{attrs:{type:"submit",color:"primary",disabled:e.cacheForm.busy,loading:e.cacheForm.busy}},[e._v("\n                        "+e._s(e.$t("Clear cache"))+"\n                      ")])],1)],1)],1)],1)],1)],1),e._v(" "),a("v-row",[a("v-col",[a("v-card",{attrs:{outlined:""}},[a("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Cron"))+"\n                ")]),e._v(" "),a("v-card-text",[a("p",[e._v("\n                    "+e._s(e.$t("Certain application tasks are supposed to run automatically on a regular basis."))+"\n                    "+e._s(e.$t("To make it work please add the following system cron job."))+"\n                    "+e._s(e.$t("Please note that the command-line (cli) PHP version on your server should also meet the minimum PHP version requirements, otherwise the cron job will fail to execute."))+"\n                    "+e._s(e.$t("If you add the cron job via cPanel you need to omit the leading asterisk symbols."))+"\n                    "+e._s(e.$t("Please refer to the installation guide for more information how to add a cron job."))+"\n                  ")]),e._v(" "),a("v-form",{on:{submit:function(t){return t.preventDefault(),e.cron(t)}}},[a("v-text-field",{ref:"cron",attrs:{dense:"",outlined:"",readonly:"","append-icon":"mdi-content-copy",value:e.data.cron_job,disabled:!e.dataLoaded},on:{"click:append":function(t){return e.copyToClipboard(e.$refs.cron)}}}),e._v(" "),a("v-skeleton-loader",{attrs:{type:"button",loading:!e.dataLoaded}},[a("v-btn",{attrs:{type:"submit",color:"primary",disabled:e.cronForm.busy,loading:e.cronForm.busy}},[e._v("\n                        "+e._s(e.$t("Execute cron job manually"))+"\n                      ")])],1)],1)],1)],1)],1)],1),e._v(" "),a("v-row",[a("v-col",[a("v-card",{attrs:{outlined:""}},[a("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Queues"))+"\n                ")]),e._v(" "),a("v-card-text",[a("v-row",[a("v-col",[a("v-btn",{attrs:{to:{name:"admin.maintenance.jobs.index"},color:"primary"}},[e._v("\n                        "+e._s(e.$t("Jobs"))+"\n                      ")]),e._v(" "),a("v-btn",{attrs:{to:{name:"admin.maintenance.failed-jobs.index"},color:"primary"}},[e._v("\n                        "+e._s(e.$t("Failed jobs"))+"\n                      ")])],1)],1),e._v(" "),a("v-form",{staticClass:"mt-5",on:{submit:function(t){return t.preventDefault(),e.clearQueue(t)}}},[a("v-select",{attrs:{items:e.data.queues,label:e.$t("Queue"),outlined:"",disabled:!e.data.queues,"hide-details":!0},scopedSlots:e._u([{key:"append-outer",fn:function(){return[a("v-skeleton-loader",{attrs:{type:"button",loading:!e.dataLoaded}},[a("v-btn",{attrs:{type:"submit",color:"primary",disabled:!e.clearQueueForm.queue||e.clearQueueForm.busy,loading:e.clearQueueForm.busy}},[e._v("\n                            "+e._s(e.$t("Delete all jobs from the queue"))+"\n                          ")])],1)]},proxy:!0}]),model:{value:e.clearQueueForm.queue,callback:function(t){e.$set(e.clearQueueForm,"queue",t)},expression:"clearQueueForm.queue"}})],1),e._v(" "),a("v-form",{staticClass:"mt-5",on:{submit:function(t){return t.preventDefault(),e.stopQueueWorker(t)}}},[a("v-skeleton-loader",{attrs:{type:"button",loading:!e.dataLoaded}},[a("v-btn",{attrs:{type:"submit",color:"primary",disabled:e.stopQueueWorkerForm.busy,loading:e.stopQueueWorkerForm.busy}},[e._v("\n                        "+e._s(e.$t("Stop queue worker"))+"\n                      ")])],1)],1)],1)],1)],1)],1),e._v(" "),a("v-row",[a("v-col",[a("v-card",{attrs:{outlined:""}},[a("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Log files"))+"\n                ")]),e._v(" "),a("v-card-text",[a("v-skeleton-loader",{attrs:{type:"button",loading:!e.dataLoaded}},[e.data.log_files&&e.data.log_files.length?a("div",e._l(e.data.log_files,(function(t,n){return a("v-btn",{key:n,staticClass:"text-lowercase",attrs:{color:t.isWritable?"primary":"error",tile:"",text:"",to:{name:"admin.maintenance.logs.show",params:{file:t.name}}}},[a("v-icon",{attrs:{left:""}},[e._v("\n                          mdi-file\n                        ")]),e._v("\n                        "+e._s(t.name)+".log\n                        ("+e._s(t.size)+" "+e._s(e.$t("MB"))+")\n                        "),t.isWritable?e._e():a("span",{staticClass:"text-uppercase"},[e._v("\n                          "+e._s(e.$t("Permission error"))+"!\n                        ")])],1)})),1):a("div",[e._v("\n                      "+e._s(e.$t("There are no log files."))+"\n                    ")])])],1)],1)],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,null,null);const q=Q.exports;f()(Q,{VBtn:b.Z,VCard:h.Z,VCardText:g.ZB,VCardTitle:g.EB,VCol:w.Z,VContainer:y.Z,VForm:x.Z,VIcon:F.Z,VRow:$.Z,VSelect:k.Z,VSkeletonLoader:C.Z,VTextField:V.Z})}}]);
//# sourceMappingURL=admin-maintenance.js.map